# 压力分析系统打包说明

## 概述

本文档说明如何将压力分析系统打包成可执行文件，方便在没有开发环境的机器上运行。

## 打包方式

提供了两种打包方式：

### 1. 快速打包（推荐）

使用 `quick_build.py` 进行快速打包：

```bash
python quick_build.py
```

这个脚本会：
- 自动构建前端
- 安装必要的打包工具
- 创建简化的主入口文件
- 使用PyInstaller打包成单个可执行文件

### 2. 完整打包

使用 `build.py` 进行完整打包：

```bash
python build.py
```

这个脚本提供更多功能：
- 完整的依赖检查
- 详细的构建配置
- 创建安装脚本
- 生成发布包

## 前置要求

### 必需软件

1. **Python 3.8+**
   ```bash
   python --version
   ```

2. **Node.js 16+**
   ```bash
   node --version
   ```

3. **npm**
   ```bash
   npm --version
   ```

4. **R语言环境**
   - 确保R已安装并在PATH中
   - 确保必要的R包已安装

### Python依赖

打包脚本会自动安装以下依赖：
- PyInstaller（打包工具）
- 项目所需的所有Python包

## 打包步骤

### 步骤1：准备环境

```bash
# 克隆或下载项目
cd 压力系统

# 确保所有依赖已安装
pip install -r backend/requirements.txt
cd frontend && npm install && cd ..
```

### 步骤2：执行打包

```bash
# 快速打包
python quick_build.py

# 或者完整打包
python build.py
```

### 步骤3：测试可执行文件

打包完成后，在 `dist` 目录中会生成可执行文件：

- Windows: `压力分析系统.exe`
- macOS/Linux: `压力分析系统`

直接运行测试：

```bash
# Windows
dist/压力分析系统.exe

# macOS/Linux
./dist/压力分析系统
```

## 打包配置

### 自定义配置

可以修改 `build_config.py` 来自定义打包配置：

```python
# 项目信息
PROJECT_NAME = "压力分析系统"
PROJECT_VERSION = "1.0.0"

# 可执行文件名
EXECUTABLE_NAME = "pressure_analysis_system"

# 包含的数据文件
DATA_FILES = [
    ("backend/r_analysis", "r_analysis"),
    ("backend/static", "static"),
    ("frontend/dist", "frontend_dist"),
]
```

### 隐藏导入

如果遇到模块导入问题，可以在 `HIDDEN_IMPORTS` 中添加：

```python
HIDDEN_IMPORTS = [
    'uvicorn',
    'fastapi',
    'pandas',
    'numpy',
    'rpy2',
    # 添加其他需要的模块
]
```

## 常见问题

### 1. 前端构建失败

```bash
# 清理node_modules重新安装
cd frontend
rm -rf node_modules package-lock.json
npm install
npm run build
```

### 2. PyInstaller安装失败

```bash
# 升级pip
pip install --upgrade pip

# 重新安装PyInstaller
pip install pyinstaller
```

### 3. R相关错误

确保：
- R已正确安装
- rpy2包版本兼容
- 必要的R包已安装

### 4. 可执行文件过大

可以尝试：
- 使用 `--exclude-module` 排除不需要的模块
- 使用 `--onedir` 而不是 `--onefile`
- 清理不必要的依赖

### 5. 运行时错误

检查：
- 所有数据文件是否正确包含
- 路径配置是否正确
- 权限设置是否正确

## 发布包结构

完整打包后会生成 `release` 目录，包含：

```
release/
├── 压力分析系统(.exe)     # 可执行文件
├── README.md              # 说明文档
├── 使用说明.md            # 使用指南
├── demo_data.csv          # 示例数据
├── test_data.csv          # 测试数据
└── install.sh/install.bat # 安装脚本
```

## 部署说明

### 单机部署

1. 将可执行文件复制到目标机器
2. 确保目标机器有R环境
3. 直接运行可执行文件

### 网络部署

可执行文件默认监听 `0.0.0.0:8000`，可以：
1. 在服务器上运行
2. 通过浏览器访问 `http://服务器IP:8000`
3. 配置防火墙开放8000端口

## 性能优化

### 启动优化

- 使用SSD存储
- 确保足够的内存
- 关闭不必要的后台程序

### 运行优化

- 定期清理临时文件
- 监控内存使用
- 优化R脚本性能

## 技术支持

如果遇到问题：

1. 检查日志输出
2. 确认环境配置
3. 查看错误信息
4. 联系技术支持

---

**注意**: 打包后的可执行文件仍需要R环境支持，请确保目标机器已安装R语言。 
# 压力数据分析系统 - 使用说明

## ✅ 问题已解决！

### 🔧 修复的主要问题：

1. **Python模块导入路径错误**
   - ✅ 修复了所有相对导入路径
   - ✅ 创建了正确的启动脚本
   - ✅ 确保从项目根目录启动服务

2. **R分析脚本数据类型错误**
   - ✅ 修复了力值数据清理问题（移除"N"字符）
   - ✅ 添加了数据类型转换和验证
   - ✅ 改进了错误处理机制

3. **API响应模型不匹配**
   - ✅ 调整了API响应格式
   - ✅ 修复了数据结构映射问题

## 🚀 系统功能

### 📊 核心功能
- **文件上传**: 支持CSV格式的压力数据文件
- **数据预览**: 自动显示数据统计和样本
- **智能分析**: 使用R语言进行专业数据分析
- **图表生成**: 自动生成多种分析图表
- **结果展示**: 提供详细的分析报告和建议

### 📈 生成的图表
1. **力值分布直方图** - 显示力值的分布特征
2. **力值时间序列图** - 显示力值随时间的变化趋势  
3. **目标力值分析图** - 分析测量值与目标值的关系

## 🛠️ 启动系统

### 1. 启动后端服务
```bash
python run_server.py
```

### 2. 访问系统
- **主要服务**: http://localhost:8000
- **API文档**: http://localhost:8000/docs
- **测试页面**: http://localhost:8000/static/test_upload.html
- **健康检查**: http://localhost:8000/health

## 📝 使用流程

### 1. 上传数据文件
- 支持CSV格式
- 必须包含"力值"列
- 力值可以包含单位（如"3.6N"），系统会自动清理

### 2. 数据预览
- 系统自动显示数据统计信息
- 包括数据点数量、平均值、标准差等
- 显示前5行样本数据

### 3. 启动分析
- 设置目标力值（默认：5N, 25N, 50N）
- 设置容差范围（绝对容差和百分比容差）
- 点击"开始分析"按钮

### 4. 查看结果
- 实时显示分析进度
- 分析完成后自动显示结果
- 包括统计摘要、图表和建议

## 🔧 API接口

### 文件上传
```bash
POST /api/upload
Content-Type: multipart/form-data
```

### 数据预览
```bash
GET /api/preview/{filename}
```

### 启动分析
```bash
POST /api/analyze
Content-Type: application/json
{
  "file_id": "文件ID",
  "target_forces": [5, 25, 50],
  "tolerance_abs": 2,
  "tolerance_pct": 5
}
```

### 查看任务状态
```bash
GET /api/task/{task_id}
```

### 获取分析结果
```bash
GET /api/results/{task_id}
```

## 📊 数据格式要求

### CSV文件格式
```csv
序号,力值,时间戳
1,3.6N,2024-01-01 10:00:00
2,23.5N,2024-01-01 10:00:01
3,48.2N,2024-01-01 10:00:02
...
```

### 必需列
- **力值**: 包含压力测量数据（可带单位）
- 其他列为可选

## 🎯 分析结果说明

### 统计指标
- **数据点数量**: 有效数据的总数
- **平均力值**: 所有测量值的平均值
- **标准差**: 数据的离散程度
- **成功率**: 符合目标要求的数据比例

### 图表说明
1. **直方图**: 显示力值的分布模式
2. **时间序列**: 显示力值的时间变化趋势
3. **目标分析**: 显示与目标值的偏差情况

## 🔍 故障排除

### 常见问题
1. **端口被占用**: 使用 `lsof -i :8000` 检查并终止占用进程
2. **R包缺失**: 确保安装了ggplot2、dplyr、jsonlite包
3. **文件格式错误**: 确保CSV文件包含"力值"列

### 日志查看
- 服务器日志会显示在终端中
- R分析日志保存在分析结果目录中

## 📞 技术支持

如遇问题，请检查：
1. Python环境和依赖包
2. R环境和必需包
3. 文件权限和目录结构
4. 网络端口可用性

---

**系统状态**: ✅ 正常运行  
**最后更新**: 2025-06-05  
**版本**: v1.0.0 